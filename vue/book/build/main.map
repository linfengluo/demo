{"version":3,"sources":["webpack:///webpack/bootstrap 280adaaad2ddfd9769e3","webpack:///external \"tracer\"","webpack:///external \"express\"","webpack:///./server/config/mysql.js","webpack:///./server/controllers/bookController.js","webpack:///./server/index.js","webpack:///external \"nuxt\"","webpack:///external \"body-parser\"","webpack:///./server/api/index.js","webpack:///./units/resFormat.js","webpack:///./units/response.js","webpack:///./server/controllers/crawlerController.js","webpack:///external \"cheerio\"","webpack:///external \"xss\"","webpack:///./units/fetch.js","webpack:///external \"puppeteer\"","webpack:///external \"node-mysql-promise\"","webpack:///./nuxt.config.js"],"names":["mysql","Mysql","createConnection","host","user","password","database","listRows","BOOK_LIST","BOOK_MEMU","ErrorLog","require","dailyfile","root","SuccessLog","bookController","getRecentBook","Promise","resolve","reject","table","order","updatedAt","limit","field","select","then","result","catch","err","console","log","searchBook","name","where","getBookInfo","id","find","data","getMenu","page","direct","bookId","index","countSelect","updateBookLog","_this","lastIndex","menu","length","author","updateBook","update","Date","valueOf","affectRows","info","addBook","bookKey","bookInfo","href","replace","substr","lastIndexOf","add","logo","intro","createdAt","insertId","updateMenu","last","i","push","title","link","addAll","app","express","process","env","HOST","port","PORT","use","bodyParser","json","urlencoded","extended","set","config","dev","nuxt","builder","build","render","listen","router","Router","get","req","res","next","bookName","query","key","resFormat","success","type","bookList","crawlerController","error","getBookMenu","getBookSection","decodeURIComponent","msg","code","lackParams","SUCCESS_CODE","ERROR_CODE","LACK_PARAMS","UNAUTHENTICATED","SEARCH_LINK","BOOK_SITE","BOOK_TABLE","encodeURIComponent","searchUrl","crawlerFetch","$","cheerio","load","each","elem","text","attr","desc","realLink","substring","sort","a","b","count","total","Math","ceil","num","indexOf","slice","updateBooks","bookLink","content","prev","xss","html","split","match","fetch","timeout","headless","executablePath","args","browser","puppeteer","launch","newPage","goto","close","module","exports","head","meta","charset","hid","rel","loading","color","css","src","lang","plugins","ssr","extend","isDev","isClient","rules","enforce","test","loader","exclude"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 280adaaad2ddfd9769e3","module.exports = require(\"tracer\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"tracer\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 1\n// module chunks = 0","/**\n * Created by linfengluo@gmail.com on 2018/5/17.\n */\nimport Mysql from 'node-mysql-promise'\n\nconst mysql = Mysql.createConnection({\n    host: process.env.NODE_ENV === 'development' ? '111.67.193.69' : 'localhost',\n    user: 'feng',\n    password: 'feng@3618',\n    database: 'book',\n    listRows: 20\n});\n\nexport default mysql\n\n\n\n// WEBPACK FOOTER //\n// ./server/config/mysql.js","/**\n * Created by linfengluo@gmail.com on 2018/7/9.\n */\nimport mysql from '../config/mysql'\nconst BOOK_LIST = 'b_list';\nconst BOOK_MEMU = 'b_menu';\n\nconst ErrorLog = require('tracer').dailyfile({root: './server/logs/error/'});\nconst SuccessLog = require('tracer').dailyfile({root: './server/logs/success/'});\n\nconst bookController = {\n\tgetRecentBook(){\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tmysql.table(BOOK_LIST)\n\t\t\t\t.order({updatedAt: 'DESC'})\n\t\t\t\t.limit(10)\n\t\t\t\t.field('id,name,author, logo, href, updatedAt')\n\t\t\t\t.select()\n\t\t\t\t.then(result => {\n\t\t\t\t\tresolve(result)\n\t\t\t\t})\n\t\t\t\t.catch(err => {\n\t\t\t\t\tconsole.log(err)\n\t\t\t\t})\n\t\t})\n\t},\n\tsearchBook(name){\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tmysql.table(BOOK_LIST)\n\t\t\t\t.where({name: ['LIKE', name]})\n\t\t\t\t.select()\n\t\t\t\t.then(result => {\n\t\t\t\t\tresolve(result)\n\t\t\t\t})\n\t\t})\n\t},\n\n\tgetBookInfo(id){\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tmysql.table(BOOK_LIST)\n\t\t\t\t.where({\n\t\t\t\t\tid: id\n\t\t\t\t})\n\t\t\t\t.field('id,name,author, logo, href, updatedAt, intro')\n\t\t\t\t.find()\n\t\t\t\t.then((data) => {\n\t\t\t\t\tresolve(data)\n\t\t\t\t})\n\t\t\t\t.catch(err => {\n\t\t\t\t\treject(err)\n\t\t\t\t})\n\t\t})\n\n\t},\n\n\tgetMenu(id, page, direct = 'ASC'){\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tmysql.table(BOOK_MEMU)\n\t\t\t\t.where({bookId: id})\n\t\t\t\t.field('title,link,index, id')\n\t\t\t\t.order({index: direct})\n\t\t\t\t.page(page, 50)\n\t\t\t\t.countSelect()\n\t\t\t\t.then(result => {\n\t\t\t\t\tresolve(result)\n\t\t\t\t})\n\t\t\t\t.catch(err => {\n\t\t\t\t\tconsole.log(err)\n\t\t\t\t})\n\t\t})\n\n\t},\n\tupdateBookLog(data){\n\t\tconst _this = this\n\t\tconst lastIndex = data.menu[data.menu.length - 1].index\n\t\tmysql.table(BOOK_LIST).where({\n\t\t\tname: data.name,\n\t\t\tauthor: data.author\n\t\t}).find().then(function (result) {\n\t\t\t// if (result.lastIndex < lastIndex) {\n\t\t\t// \t_this.updateBook(result, data, lastIndex)\n\t\t\t// \t_this.updateMenu(result.id, result.bookKey, data.menu, result.lastIndex)\n\t\t\t// }\n\t\t})\n\t},\n\n\tupdateBook(data, lastIndex){\n\t\tmysql.table(BOOK_LIST)\n\t\t\t.where({\n\t\t\t\tid: data.id,\n\t\t\t})\n\t\t\t.update({\n\t\t\t\tupdatedAt: new Date().valueOf(),\n\t\t\t\tlastIndex: lastIndex\n\t\t\t})\n\t\t\t.then((affectRows) => {\n\t\t\t\tSuccessLog.info(`${data.name}: 更新成功`)\n\t\t\t})\n\t},\n\n\taddBook(data, lastIndex){\n\t\tconst _this = this\n\t\tlet bookKey = data.bookInfo.href.replace(/^https?:\\/\\/(([a-zA-Z0-9_-])+(\\.)?)biquge5200\\.cc\\//i, '')\n\t\tbookKey = bookKey.substr(0, bookKey.lastIndexOf('/'))\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tmysql.table(BOOK_LIST)\n\t\t\t\t.add({\n\t\t\t\t\tname: data.bookInfo.name,\n\t\t\t\t\tauthor: data.bookInfo.author,\n\t\t\t\t\tlogo: data.bookInfo.logo,\n\t\t\t\t\tintro: data.bookInfo.intro,\n\t\t\t\t\thref: data.bookInfo.href,\n\t\t\t\t\tbookKey: bookKey,\n\t\t\t\t\tlastIndex: lastIndex,\n\t\t\t\t\tcreatedAt: new Date().valueOf(),\n\t\t\t\t\tupdatedAt: new Date().valueOf()\n\t\t\t\t})\n\t\t\t\t.then((insertId) => {\n\t\t\t\t\tSuccessLog.info(`${data.bookInfo.name}: 添加成功（${insertId}）`)\n\t\t\t\t\t_this.updateMenu(insertId, bookKey, data.data, 0)\n\t\t\t\t\tresolve(insertId)\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\tErrorLog.info(`${data.bookInfo.name}: 添加失败(${err})`)\n\t\t\t\t})\n\t\t})\n\n\t},\n\n\tupdateMenu(id, bookKey, menu, last){\n\t\tlet data = []\n\t\tfor (let i = menu.length - 1; i >= 0; i--) {\n\t\t\tif (menu[i].index > last) {\n\t\t\t\tdata.push({\n\t\t\t\t\tbookId: id,\n\t\t\t\t\tbookKey: bookKey,\n\t\t\t\t\ttitle: menu[i].title,\n\t\t\t\t\tlink: menu[i].link,\n\t\t\t\t\tindex: menu[i].index,\n\t\t\t\t\tcreatedAt: new Date().valueOf(),\n\t\t\t\t\tupdatedAt: new Date().valueOf()\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tmysql.table(BOOK_MEMU)\n\t\t\t.addAll(data)\n\t\t\t.then(() => {\n\t\t\t\tSuccessLog.info('更新成功')\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tErrorLog.info('更新失败')\n\t\t\t})\n\t}\n}\n\nexport default bookController\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/bookController.js","import express from 'express'\nimport {Nuxt, Builder} from 'nuxt'\nimport bodyParser from 'body-parser'\n// import cookieParser from 'cookie-parser'\n// import session from 'express-session'\nimport apiRouter from './api'\n\nconst app = express()\nconst host = process.env.HOST || '127.0.0.1'\nconst port = process.env.PORT || 3030\n\n\napp.use(bodyParser.json())\napp.use(bodyParser.urlencoded({extended: false}))\n// app.use(cookieParser())\n// app.use(session({\n//     secret: 'book',\n//     resave: false,\n//     saveUninitialized: false\n// }))\n\napp.set('port', port)\n\napp.use(apiRouter)\n\n// Import and Set Nuxt.js options\nlet config = require('../nuxt.config.js')\nconfig.dev = !(process.env.NODE_ENV === 'production')\n\n// Init Nuxt.js\nconst nuxt = new Nuxt(config)\n\n// Build only in dev mode\nif (config.dev) {\n    const builder = new Builder(nuxt)\n    builder.build()\n}\n\n// Give nuxt middleware to express\napp.use(nuxt.render)\n\n// Listen the server\napp.listen(port, host)\n\nconsole.log('Server listening on ' + host + ':' + port) // eslint-disable-line no-console\n\n\n\n\n// WEBPACK FOOTER //\n// ./server/index.js","module.exports = require(\"nuxt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"nuxt\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"body-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"body-parser\"\n// module id = 6\n// module chunks = 0","/**\n * Created by linfengluo@gmail.com on 2018/7/9.\n */\nimport {Router} from 'express'\nimport resFormat from '../../units/resFormat'\nimport crawlerController from '../controllers/crawlerController'\nimport bookController from '../controllers/bookController'\n\nconst router = Router()\n\nrouter.get('/api/search', function (req, res, next) {\n\tconst bookName = req.query.key\n\n\tbookController.searchBook(bookName)\n\t\t.then(data => {\n\t\t\tif (data.length > 0) {\n\t\t\t\treturn res.json(resFormat.success({\n\t\t\t\t\ttype: 'local',\n\t\t\t\t\tbookList: data\n\t\t\t\t}))\n\t\t\t} else {\n\t\t\t\tcrawlerController.searchBook(bookName)\n\t\t\t\t\t.then(data => {\n\t\t\t\t\t\treturn res.json(resFormat.success({\n\t\t\t\t\t\t\ttype: 'online',\n\t\t\t\t\t\t\tbookList: data\n\t\t\t\t\t\t}))\n\n\t\t\t\t\t})\n\t\t\t\t\t.catch(err => {\n\t\t\t\t\t\treturn res.json(resFormat.error(err))\n\t\t\t\t\t})\n\t\t\t}\n\t\t})\n\n})\n\nrouter.get('/api/book/menu', function (req, res, next) {\n\tconst type = req.query.type\n\tconst page = typeof req.query.page == 'undefined' ? 1 : req.query.page\n\tconst direct = typeof req.query.direct == 'undefined' ? 'ASC' : req.query.direct\n\tconst key = req.query.key\n\n\n\tif (type === 'local') {\n\t\tbookController.getMenu(key, page, direct)\n\t\t\t.then(data => {\n\t\t\t\treturn res.json(resFormat.success(data))\n\t\t\t})\n\t\t\t.catch(err => {\n\t\t\t\tconsole.log(err)\n\t\t\t})\n\t} else {\n\t\tcrawlerController.getBookMenu(key, direct)\n\t\t\t.then(data => {\n\t\t\t\treturn res.json(resFormat.success(data))\n\t\t\t})\n\t\t\t.catch(err => {\n\t\t\t\treturn res.json(resFormat.error(err))\n\t\t\t})\n\t}\n})\nrouter.get('/api/book/hot', function (req, res, next) {\n\n\tbookController.getRecentBook()\n\t\t.then(data => {\n\t\t\treturn res.json(resFormat.success(data))\n\t\t})\n})\nrouter.get('/api/book/info', function (req, res, next) {\n\n\tbookController.getBookInfo(req.query.id)\n\t\t.then(data => {\n\t\t\treturn res.json(resFormat.success(data))\n\t\t})\n\t\t.catch(err => {\n\t\t\tconsole.log(err)\n\t\t})\n})\nrouter.get('/api/book/section', function (req, res, next) {\n\tcrawlerController.getBookSection(decodeURIComponent(req.query.link))\n\t\t.then(data => {\n\t\t\treturn res.json(resFormat.success(data))\n\t\t})\n\t\t.catch(err => {\n\t\t\tconsole.log(err)\n\t\t})\n})\n\nexport default router\n\n\n\n// WEBPACK FOOTER //\n// ./server/api/index.js","/**\n * Created by linfengluo@gmail.com on 2018/5/18.\n */\nimport * as CODE from './response'\n\nconst resFormat  = {\n  error(error, msg = '出错啦，请稍后再试！'){\n    return {\n      code: CODE.ERROR_CODE,\n      data: error,\n      msg: msg\n    }\n  },\n\n  success(result = {}, msg = '获取成功'){\n    return {\n      code: CODE.SUCCESS_CODE,\n      data: result,\n      msg: msg\n    }\n  },\n\n  lackParams(msg = '缺少参数'){\n    return {\n      code: CODE.LACK_PARAMS,\n      data: {},\n      msg: msg\n    }\n  }\n}\n\nexport default resFormat\n\n\n\n// WEBPACK FOOTER //\n// ./units/resFormat.js","/**\r\n * Created by linfengluo@gmail.com on 2018/5/18.\r\n */\r\nexport const SUCCESS_CODE = 200\r\nexport const ERROR_CODE = 201\r\nexport const LACK_PARAMS = 202\r\nexport const UNAUTHENTICATED = 401\n\n\n// WEBPACK FOOTER //\n// ./units/response.js","/**\n * Created by linfengluo@gmail.com on 2018/7/9.\n */\nimport cheerio from 'cheerio'\nimport xss from 'xss'\nimport crawlerFetch from '../../units/fetch'\nimport mysql from '../config/mysql'\nimport bookController from './bookController'\n\nconst SEARCH_LINK = 'https://www.baidu.com/s?wd='\nconst BOOK_SITE = 'www.biquge5200.cc'\nconst BOOK_TABLE = 'b_list';\n\nconst ErrorLog = require('tracer').dailyfile({root: './server/logs/error/'});\nconst SuccessLog = require('tracer').dailyfile({root: './server/logs/success/'});\n\nconst crawlerController = {\n\tsearchBook(name){\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst key = encodeURIComponent(`${name} site:${BOOK_SITE}`)\n\t\t\tconst searchUrl = `${SEARCH_LINK}${key}`\n\t\t\tcrawlerFetch(searchUrl)\n\t\t\t\t.then(res => {\n\t\t\t\t\tlet $ = cheerio.load(res);\n\t\t\t\t\tlet data = [];\n\n\t\t\t\t\t$('#content_left .result').each((i, elem) => {\n\t\t\t\t\t\tdata.push({\n\t\t\t\t\t\t\ttitle: $(elem).find('a').text(),\n\t\t\t\t\t\t\tlink: $(elem).find('a').attr('href')\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\n\t\t\t\t\tresolve(data)\n\t\t\t\t})\n\t\t\t\t.catch(err => {\n\t\t\t\t\treject(err)\n\t\t\t\t})\n\t\t})\n\t},\n\n\tgetBookMenu(link, direct){\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tcrawlerFetch(link)\n\t\t\t\t.then(res => {\n\t\t\t\t\tlet $ = cheerio.load(res);\n\t\t\t\t\tlet menu = [];\n\n\t\t\t\t\tconst title = $('#info h1').text()\n\t\t\t\t\tconst logo = $('#fmimg img').attr('src')\n\t\t\t\t\tconst desc = $('#intro').text()\n\t\t\t\t\tconst realLink = $(\"meta[property='og:novel:read_url']\").attr(\"content\")\n\t\t\t\t\tlet author = ''\n\n\t\t\t\t\t$('#info p').each((i, elem) => {\n\t\t\t\t\t\tif (i == 0) {\n\t\t\t\t\t\t\tauthor = $(elem).text()\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\n\t\t\t\t\t$('#list dl dd').each((i, elem) => {\n\t\t\t\t\t\tlet link = $(elem).find('a').attr('href')\n\t\t\t\t\t\tif (i > 8) {\n\t\t\t\t\t\t\tmenu.push({\n\t\t\t\t\t\t\t\ttitle: $(elem).find('a').text(),\n\t\t\t\t\t\t\t\tlink: link,\n\t\t\t\t\t\t\t\tindex: link.substring(link.lastIndexOf('/') + 1, link.lastIndexOf('.'))\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\n\t\t\t\t\tmenu = menu.sort((a, b) => {\n\t\t\t\t\t\treturn a.index - b.index\n\t\t\t\t\t})\n\n\t\t\t\t\tconst result = {\n\t\t\t\t\t\tcount: menu.length,\n\t\t\t\t\t\ttotal: Math.ceil(menu.length / 50),\n\t\t\t\t\t\tpage: 1,\n\t\t\t\t\t\tnum: 50,\n\t\t\t\t\t\tdata: menu,\n\t\t\t\t\t\tbookInfo: {\n\t\t\t\t\t\t\tlogo: logo,\n\t\t\t\t\t\t\thref: realLink,\n\t\t\t\t\t\t\tintro: desc,\n\t\t\t\t\t\t\tname: title,\n\t\t\t\t\t\t\tauthor: author.substr(author.indexOf(\"：\") + 1),\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbookController.addBook(result, menu[menu.length-1].index)\n\t\t\t\t\t\t.then(id => {\n\t\t\t\t\t\t\tresult.bookInfo.id = id\n\t\t\t\t\t\t\tresult.data = direct == 'ASC' ? menu.slice(0, 50) : menu.slice(-50)\n\t\t\t\t\t\t\tresolve(result)\n\t\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t\t.catch(err => {\n\t\t\t\t\treject(err)\n\t\t\t\t})\n\t\t})\n\t},\n\n\tupdateBooks(data){\n\t\tmysql.table(BOOK_TABLE).where({\n\t\t\tname: data.name,\n\t\t\tauthor: data.author\n\t\t}).find().then(function (data) {\n\t\t\tif (!data) {\n\t\t\t\tthis.addBook(data)\n\t\t\t} else {\n\n\t\t\t}\n\t\t})\n\t},\n\n\tupdateMenu(){\n\n\t},\n\n\taddBook(data){\n\t\tmysql.table(BOOK_TABLE)\n\t\t\t.add({\n\t\t\t\tname: data.name,\n\t\t\t\tauthor: data.author,\n\t\t\t\tlogo: data.logo,\n\t\t\t\thref: data.bookLink,\n\t\t\t\tlastIndex: data.menu[data.menu.length - 1].index,\n\t\t\t\tcreatedAt: new Date().valueOf(),\n\t\t\t\tupdatedAt: new Date().valueOf()\n\t\t\t})\n\t\t\t.then((insertId) => {\n\t\t\t\tSuccessLog.info(`${data.name}: 添加成功（${insertId}）`)\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tErrorLog.info(`${data.name}: 添加失败(${err})`)\n\t\t\t})\n\t},\n\n\tgetBookSection(link){\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tcrawlerFetch(link)\n\t\t\t\t.then(res => {\n\t\t\t\t\tlet $ = cheerio.load(res);\n\t\t\t\t\tlet data = {\n\t\t\t\t\t\tcontent: '',\n\t\t\t\t\t\tnext: '',\n\t\t\t\t\t\tprev: '',\n\t\t\t\t\t\ttitle: ''\n\t\t\t\t\t}\n\n\t\t\t\t\tdata.content = xss($('#content').html())\n\t\t\t\t\tdata.title = $('.bookname h1').text()\n\t\t\t\t\tdata.name = $('meta[name=keywords]').attr('content').split(',')[0]\n\n\t\t\t\t\t$('.bottem1 a').each((i, elem) => {\n\t\t\t\t\t\tif ($(elem).text().match('上一章')) {\n\t\t\t\t\t\t\tdata.prev = $(elem).attr('href')\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ($(elem).text().match('下一章')) {\n\t\t\t\t\t\t\tdata.next = $(elem).attr('href')\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\n\t\t\t\t\tresolve(data)\n\t\t\t\t})\n\t\t\t\t.catch(err => {\n\t\t\t\t\treject(err)\n\t\t\t\t})\n\t\t})\n\n\t}\n}\n\nexport default crawlerController\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/crawlerController.js","module.exports = require(\"cheerio\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"cheerio\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"xss\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"xss\"\n// module id = 12\n// module chunks = 0","/**\n * Created by linfengluo@gmail.com on 2018/7/9.\n */\nimport puppeteer from 'puppeteer'\nconst ErrorLog = require('tracer').dailyfile({root: './server/logs/error/'});\nconst SuccessLog = require('tracer').dailyfile({root: './server/logs/success/'});\nconst fetch = (href, title = '', type = 'get') => {\n  return new Promise(async (resolve, reject) => {\n  \tlet config = {\n\t\ttimeout: 0,\n\t\theadless: true\n\t}\n\n\tif (process.env.NODE_ENV === 'development' ) {\n  \t\tconfig.executablePath = \"E:\\\\temp\\\\demo\\\\bookReader\\\\chromium\\\\chrome.exe\"\n\t} else {\n\t\tconfig.args = ['--no-sandbox', '--disable-setuid-sandbox']\n\t}\n    try {\n\t\tconst browser = await puppeteer.launch(config);\n\t\tconst page = await browser.newPage();\n\t\tawait page.goto(href);\n\t\tconst content = await page.content();\n\t\tawait browser.close();\n\t\tresolve(content)\n\t} catch (err){\n\t\tErrorLog.error(`puppeteer : ${err}`)\n\t}\n  })\n\n}\n\nexport default fetch\n\n\n\n// WEBPACK FOOTER //\n// ./units/fetch.js","module.exports = require(\"puppeteer\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"puppeteer\"\n// module id = 14\n// module chunks = 0","module.exports = require(\"node-mysql-promise\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-mysql-promise\"\n// module id = 15\n// module chunks = 0","module.exports = {\n  /*\n  ** Headers of the page\n  */\n  head: {\n    title: 'book',\n    meta: [\n      { charset: 'utf-8' },\n      { name: 'viewport', content: 'width=device-width, initial-scale=1' },\n      { hid: 'description', name: 'description', content: 'Nuxt.js project' }\n    ],\n    link: [\n      { rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' }\n    ]\n  },\n  /*\n  ** Customize the progress bar color\n  */\n  loading: { color: '#3B8070' },\n  /*\n  ** Build configuration\n  */\n  css: [\n    {\n      src: '~/scss/main.scss',\n      lang: 'scss'\n    },\n  ],\n  plugins: [\n    '~/plugins/muse.js',\n\t  {\n\t\t  src: '~/plugins/globalMixins.js',\n\t\t  ssr: true\n\t  },\n  ],\n  build: {\n    /*\n    ** Run ESLint on save\n    */\n    extend (config, { isDev, isClient }) {\n      if (isDev && isClient) {\n        config.module.rules.push({\n          enforce: 'pre',\n          test: /\\.(js|vue)$/,\n          loader: 'eslint-loader',\n          exclude: /(node_modules)/\n        })\n      }\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./nuxt.config.js"],"sourceRoot":""}